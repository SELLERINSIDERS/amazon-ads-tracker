# Plan 07-01: API Key Management

## Goal
Enable API key creation and management for agent authentication.

## Requirements Covered
- AGNT-01: Agent authenticates via X-Agent-Key header
- SETT-04: Settings page allows user to generate, rotate, and revoke agent API keys

## Tasks

### 1. Add AgentApiKey Model to Prisma Schema
```prisma
model AgentApiKey {
  id          String    @id @default(cuid())
  name        String
  key         String    @unique
  lastUsedAt  DateTime?
  createdAt   DateTime  @default(now())
  revokedAt   DateTime?
}
```

### 2. Create API Key Service (lib/agent-key.ts)
- generateApiKey() - creates new random key
- validateApiKey() - checks key is valid and not revoked
- revokeApiKey() - marks key as revoked
- getApiKeys() - lists all keys (without exposing full key)

### 3. Create Agent Auth Middleware (lib/agent-auth.ts)
- Validates X-Agent-Key header
- Updates lastUsedAt timestamp
- Returns 401 for invalid/revoked keys

### 4. Create API Key Settings Component
- Show masked keys (****-****-XXXX)
- Generate new key button
- Revoke key button
- Copy key to clipboard (only when newly generated)

### 5. Add API Key Section to Settings Page
Replace placeholder with actual component.

## Verification
- [ ] Migration runs successfully
- [ ] Can generate new API key
- [ ] Can validate API key via middleware
- [ ] Can revoke API key
- [ ] Revoked keys are rejected

## Estimated Complexity
Medium
