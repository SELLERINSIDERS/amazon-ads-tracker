# Plan 07-04: Chat Messages

## Goal
Create chat message system for agent-user communication.

## Requirements Covered
- AGNT-05: Agent can post and read chat messages via API
- CHAT-01, CHAT-02: User can view and send messages to agent

## Tasks

### 1. Add AgentMessage Model to Prisma Schema
```prisma
model AgentMessage {
  id        String   @id @default(cuid())
  role      String   // 'user' | 'agent'
  content   String
  metadata  String?  // JSON for proposed actions, approvals, etc.
  createdAt DateTime @default(now())
}
```

### 2. Create /api/agent/messages Endpoint
- GET - Returns recent messages (with pagination)
- POST - Agent posts a message

### 3. Create Chat Messages Service (lib/chat.ts)
- getMessages(limit?, before?)
- postMessage(role, content, metadata?)
- Simple message storage, no complex workflow

### 4. Create Chat UI Component
- Simple message list
- User input field
- Send button
- Messages refresh on interval or after send

### 5. Add Chat Section to Dashboard or New Chat Page
Location: /chat or sidebar widget

## Message Format
```json
{
  "role": "agent",
  "content": "I recommend reducing bid on keyword 'wireless mouse' from $1.50 to $1.20 due to high ACoS.",
  "metadata": {
    "proposedAction": {
      "type": "bid_change",
      "keywordId": "...",
      "currentBid": 1.50,
      "proposedBid": 1.20
    }
  }
}
```

## Verification
- [ ] Messages model created
- [ ] GET endpoint returns messages
- [ ] POST endpoint creates messages
- [ ] Chat UI displays messages
- [ ] User can send messages

## Estimated Complexity
Medium
