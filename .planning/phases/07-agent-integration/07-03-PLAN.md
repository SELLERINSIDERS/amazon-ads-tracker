# Plan 07-03: Agent Action API Endpoints

## Goal
Create REST API endpoints for agents to execute actions with safety limits.

## Requirements Covered
- AGNT-03: Agent can execute actions via POST endpoints
- AGNT-04: All agent actions respect safety limits and are logged
- AGNT-07: Agent can trigger data sync and register heartbeat

## Tasks

### 1. Create /api/agent/heartbeat Endpoint
POST - Registers agent heartbeat
Body: { status: string }

### 2. Create /api/agent/sync Endpoint
POST - Triggers data sync
Returns sync status

### 3. Create /api/agent/actions/bid Endpoint
POST - Adjust keyword bid
Body: { keywordId, newBid, reason? }
- Validate against safety limits
- Log to audit trail
- Return new bid value

### 4. Create /api/agent/actions/budget Endpoint
POST - Adjust campaign budget
Body: { campaignId, newBudget, reason? }
- Validate against safety limits
- Log to audit trail
- Return new budget value

### 5. Create /api/agent/actions/status Endpoint
POST - Change entity status
Body: { entityType, entityId, status, reason? }
- Log to audit trail
- Return new status

### 6. Store Agent Heartbeat
Add AgentHeartbeat model or field to track last heartbeat

## Safety Validation Flow
1. Get current value from database
2. Validate change against safety limits
3. If invalid, return error with limit details
4. If valid, update database
5. Log to audit trail with actorType='agent'
6. Return success with new value

## Verification
- [ ] Heartbeat endpoint updates timestamp
- [ ] Sync endpoint triggers sync
- [ ] Bid change validates against limits
- [ ] Budget change validates against limits
- [ ] All actions logged to audit trail
- [ ] Invalid changes rejected with clear errors

## Estimated Complexity
High
