# Plan 06-01: Database Schema for Safety & Audit

## Goal
Add database models for safety limits and audit entries.

## Requirements Covered
- SAFE-01: Safety limits storage
- AUDT-01: Audit log storage

## Tasks

### 1. Add SafetyLimit Model to Prisma Schema
```prisma
model SafetyLimit {
  id                String   @id @default(cuid())
  maxBidChangePct   Float    @default(50)
  maxBudgetChangePct Float   @default(100)
  maxDailySpend     Float?
  minBidFloor       Float    @default(0.02)
  maxBidCeiling     Float    @default(100)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}
```

### 2. Add AuditEntry Model to Prisma Schema
```prisma
model AuditEntry {
  id          String   @id @default(cuid())
  timestamp   DateTime @default(now())
  actorType   String   // 'user' | 'agent' | 'rule'
  actorId     String?
  actionType  String
  entityType  String
  entityId    String
  entityName  String?
  beforeState Json?
  afterState  Json?
  reason      String?
  success     Boolean  @default(true)
  errorMsg    String?

  @@index([timestamp])
  @@index([entityType, entityId])
  @@index([actorType])
}
```

### 3. Run Migration
```bash
npx prisma migrate dev --name add-safety-audit
```

### 4. Create Type Definitions
Create types for action types and entity types in lib/types/audit.ts

## Verification
- [ ] Migration runs successfully
- [ ] SafetyLimit model accessible via Prisma
- [ ] AuditEntry model accessible via Prisma
- [ ] Indexes created for common queries

## Estimated Complexity
Low
